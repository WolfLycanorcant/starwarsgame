<!DOCTYPE html>
<html>
<head>
    <title>Game Master</title>
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        .gm-control {
            margin-bottom: 20px;
        }
        .gm-label {
            display: block;
            margin-bottom: 5px;
        }
        .gm-slider {
            width: 20px;
            height: 200px;
            writing-mode: bt-lr;
            -webkit-appearance: slider-vertical;
            transform: rotate(180deg);
        }
        .gm-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--starwars-yellow);
            cursor: pointer;
        }
        .gm-value {
            font-size: 1.5em;
            margin: 5px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl mb-6">GAME MASTER CONTROL</h1>
        
        <div class="gm-panel">
            <!-- Navigation Controls -->
            <div class="gm-control">
                <h2>Navigation</h2>
                <div class="grid">
                    <div>
                        <label class="gm-label">Horizontal Heading</label>
                        <div class="gm-value" id="current-x">0°</div>
                        <input type="range" id="heading-x" min="-180" max="180" step="1" class="gm-slider">
                    </div>
                    <div>
                        <label class="gm-label">Vertical Heading</label>
                        <div class="gm-value" id="current-y">0°</div>
                        <input type="range" id="heading-y" min="-90" max="90" step="1" class="gm-slider">
                    </div>
                    <div>
                        <label class="gm-label">Speed</label>
                        <div class="gm-value" id="current-speed">0</div>
                        <input type="range" id="speed" min="0" max="100" step="1" class="gm-slider">
                    </div>
                </div>
            </div>

            <!-- System Controls -->
            <div class="gm-control">
                <h2>Systems</h2>
                <div class="grid">
                    <div>
                        <label class="gm-label">Alert Status</label>
                        <select id="alert-status" class="bg-black border p-2">
                            <option>NORMAL</option>
                            <option>YELLOW</option>
                            <option>RED</option>
                        </select>
                    </div>
                    <div>
                        <label class="gm-label">Weapon Status (%)</label>
                        <input type="number" id="weapon-status" min="0" max="100" class="bg-black border p-2">
                    </div>
                    <div>
                        <label class="gm-label">Power Status (%)</label>
                        <input type="number" id="power-status" min="0" max="100" class="bg-black border p-2">
                    </div>
                    <div>
                        <label class="gm-label">Hull Message</label>
                        <textarea id="hull-message" rows="2" class="bg-black border p-2 w-full"></textarea>
                    </div>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="gm-control">
                <h2>Navigation</h2>
                <div class="grid">
                    <div>
                        <label class="gm-label">Altitude Simulation</label>
                        <div class="flex flex-col gap-2">
                            <div class="flex justify-between items-center">
                                <span class="text-sm">0m</span>
                                <input type="range" id="altitude-sim" min="0" max="10000" step="100" class="w-full bg-black border p-2">
                                <span class="text-sm">10,000m</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-400">Surface</span>
                                <span class="text-xs text-gray-400">Atmosphere</span>
                                <span class="text-xs text-gray-400">Space</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Communications Controls -->
            <div class="gm-control">
                <h2>Communications</h2>
                <div class="grid">
                    <div>
                        <label class="gm-label">Current Frequency</label>
                        <div id="current-frequency" class="gm-value">121.5</div>
                        <input type="number" id="new-frequency" step="0.1" class="bg-black border p-2 w-full" placeholder="Enter frequency">
                    </div>
                </div>
            </div>

            <!-- Update Button -->
            <button onclick="updateGameState()" class="bg-red-600 px-6 py-3 mt-4">
                UPDATE ALL STATIONS
            </button>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const room = params.get('room');
        const socket = io();
        
        socket.emit('join', { room, station: 'gm' });
        
        // Update state when sliders change
        document.getElementById('heading-x').addEventListener('input', function(e) {
            document.getElementById('current-x').textContent = e.target.value + '°';
        });
        
        document.getElementById('heading-y').addEventListener('input', function(e) {
            document.getElementById('current-y').textContent = e.target.value + '°';
        });
        
        document.getElementById('speed').addEventListener('input', function(e) {
            document.getElementById('current-speed').textContent = e.target.value;
        });
        
        // Listen for state updates and update GM's sliders
        socket.on('state_update', (state) => {
            // Update heading sliders
            document.getElementById('heading-x').value = state.heading.x;
            document.getElementById('current-x').textContent = state.heading.x + '°';
            
            document.getElementById('heading-y').value = state.heading.y;
            document.getElementById('current-y').textContent = state.heading.y + '°';
            
            document.getElementById('speed').value = state.speed;
            document.getElementById('current-speed').textContent = state.speed;
            
            // Update other controls
            document.getElementById('alert-status').value = state.alert;
            document.getElementById('weapon-status').value = state.systems.weapons;
            document.getElementById('power-status').value = state.systems.power;
            
            // Update frequency
            if (state.frequency) {
                document.getElementById('current-frequency').textContent = state.frequency;
            }
        });
        
        function updateGameState() {
            const changes = {
                heading: {
                    x: parseInt(document.getElementById('heading-x').value),
                    y: parseInt(document.getElementById('heading-y').value)
                },
                speed: parseInt(document.getElementById('speed').value),
                alert: document.getElementById('alert-status').value,
                systems: {
                    weapons: parseInt(document.getElementById('weapon-status').value),
                    power: parseInt(document.getElementById('power-status').value),
                    hull_message: document.getElementById('hull-message').value
                },
                frequency: parseFloat(document.getElementById('new-frequency').value) || 121.5,
                altitude: parseInt(document.getElementById('altitude-sim').value)
            };
            
            socket.emit('gm_update', {
                room,
                changes: changes
            });
        }
    </script>
</body>
</html>
