<!DOCTYPE html>
<html>
<head>
    <title>Gunner Station</title>
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* quick inline styles so the new card looks the same as on the other stations */
        :root{
            --starwars-blue:#007bff;
            --starwars-red:#dc3545;
            --bg-dark:#111;
            --text-light:#fff;
        }
        body{background:var(--bg-dark);color:var(--text-light);font-family:Arial,Helvetica,sans-serif;padding:20px;}
        .container{max-width:800px;margin:0 auto;}
        .status-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px;}
        .status-card{background:rgba(0,0,0,.7);padding:20px;border:2px solid var(--starwars-blue);border-radius:10px;}
        .status-value{font-size:2.5em;font-weight:bold;margin:10px 0;}
        .status-message{font-size:1.2em;margin:10px 0;}
        .warning{color:var(--starwars-red);}
        .critical{color:var(--starwars-red);animation:blink 1s infinite;}
        @keyframes blink{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}

        /* fire-button feedback */
        button.bg-red-600{
            transition:transform .1s,background-color .1s;
        }
        button.bg-red-600:active{
            transform:scale(.92);
            background-color:#ff0000 !important;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-3xl mb-6">GUNNER STATION</h1>

    <!-- === ALERT STATUS (whole element) === -->
    <div class="status-grid">
        <div class="status-card">
            <h2>ALERT STATUS</h2>
            <div id="alert-value" class="status-value">NORMAL</div>
            <div id="alert-status" class="status-message">All clear</div>
        </div>
    </div>

    <div class="control-panel">
        <div class="grid">
            <div>
                <h3>Weapon Status:</h3>
                <div id="weapon-status" class="text-4xl">100%</div>
            </div>
            <div>
                <h3>Target Locked:</h3>
                <div id="target-status" class="text-4xl">No</div>
            </div>
        </div>

        <div class="mt-8">
            <button onclick="fireWeapons()" class="bg-red-600 px-6 py-3">
                FIRE WEAPONS
            </button>
        </div>
    </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const room  = params.get('room');
const socket = io();

socket.emit('join', { room, station: 'gunner' });

socket.on('state_update', (state) => {
    // Weapon status
    document.getElementById('weapon-status').textContent = state.systems.weapons + '%';
    // Alert status
    updateAlertStatus(state.alert);
});

function updateAlertStatus(alert) {
    const alertVal = document.getElementById('alert-value');
    const alertMsg = document.getElementById('alert-status');
    if (!alert) return;

    alertVal.textContent = alert.toUpperCase();
    alertMsg.textContent = alert;

    const lower = alert.toLowerCase();
    alertVal.className = 'status-value';
    alertMsg.className = 'status-message';

    if (lower === 'red') {
        alertVal.style.color = '#dc3545';
        alertMsg.style.color = '#dc3545';
        alertVal.classList.add('critical');
    } else if (lower === 'yellow') {
        alertVal.style.color = '#ffd700';
        alertMsg.style.color = '#ffd700';
    } else {
        alertVal.style.color = '';
        alertMsg.style.color = '';
    }
}

function fireWeapons() {
    const btn = document.querySelector('button.bg-red-600');
    btn.classList.add('firing');
    setTimeout(() => btn.classList.remove('firing'), 150);

    socket.emit('player_action', { room, action: 'fire_weapons' });
}
</script>
</body>
</html>